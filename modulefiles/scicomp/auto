#%Module1.0

set prefix {}
set searched {}
set common [file dirname $ModulesCurrentModulefile]/.common
set supported_systems [dict create almalinux9-gcc11 el9]

proc search {path} {
    global prefix common searched
    lappend searched $path
    if [file isdirectory $path] {
        set prefix $path
        return 1
    }
    return 0
}

if {! [dict exists $supported_systems [osrelease]] } {
    warn "[osrelease] is not supported by JLab's scicomp group"
    exit 0
} elseif {! [search /scigroup/cvmfs/scicomp/sw/modulefiles] } {
    if {! [search /cvmfs/oasis.opensciencegrid.org/jlab/scicomp/sw] } {
        warn "cannot find JLab scicomp's modulefiles at any of:"
        foreach s $searched { warn \t$s }
        exit 0
    }
} else {
    source $common
}
